<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Room</title>
  <style>
    body,html { margin:0; padding:0; height:100%; }
    #local,#remote { width:100%; height:50%; }
    video { width:100%; height:100%; object-fit:cover; }
  </style>
  <script src="https://media.twiliocdn.com/sdk/js/video/releases/2.31.0/twilio-video.min.js"></script>
</head>
<body>
<div id="local"></div>
<div id="remote"></div>
<script>
  const params = new URLSearchParams(location.search);
  const token = params.get('token');
  const room = params.get('room');
  if (!token || !room) {
    document.body.textContent = 'Missing parameters';
  } else {
    Twilio.Video.connect(token, { name: room }).then(room => {
      room.localParticipant.videoTracks.forEach(p => {
        document.getElementById('local').appendChild(p.track.attach());
      });
      const addParticipant = participant => {
        participant.on('trackSubscribed', track => {
          document.getElementById('remote').appendChild(track.attach());
        });
        participant.tracks.forEach(pub => {
          if (pub.isSubscribed) document.getElementById('remote').appendChild(pub.track.attach());
        });
      };
      room.participants.forEach(addParticipant);
      room.on('participantConnected', addParticipant);
    }).catch(err => {
      document.body.textContent = err.message;
    });
  }
</script>
</body>
</html>
